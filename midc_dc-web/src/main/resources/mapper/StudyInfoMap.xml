<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.cw.midc.entity.StudyInfoEntity">

   <select id="getList" resultType="Map" parameterType="java.util.Map">
        select a.studyinfo_id as studyinfoId,a.age as age ,a.age_unit as ageUnit, a.device_id as deviceId ,
        a.pre_diagnose as  preDiagnose,
        a.abs_history as  absHistory,a.study_desc as studyDesc,a.create_time as createTime , a.update_time as updateTime ,a.clinical_manifest as clinicalManifest
        ,a.study_demand as studyDemand,a.rpt_status as rptStatus,a.trans_status as transStatus,a.status as status,a.is_available as isAvailable,a.apply_doc_name as applyDocName
        ,a.apply_dep_name as applyDepName,a.apply_time as applyTime,a.hosp_id as hospitalId,a.rpt_id as rptId,a.pat_id as patientId,b.pat_name as patientName,b.birthday as birthday,b.sex as patientSex
        ,b.patientType as patientType,c.hosp_name as hospName
         from study_info a ,patient b ,hospital c
        <where>
        	1=1
        	and a.pat_id = b.pat_id
        	
        	and a.hosp_id = c.hosp_id
            <if test="@Ognl@isNotEmpty(hospitalId)">
                and a.hosp_id = #{hospitalId}
            </if>
            <if test="@Ognl@isNotEmpty(patientName)">
                and b.pat_name like '%${patientName}%'
            </if>
            <if test="@Ognl@isNotEmpty(patientId)">
                and b.pat_id = #{patientId}
            </if>
            <if test="@Ognl@isNotEmpty(patientSex)">
                and b.sex = #{patientSex}
            </if>
            <if test="@Ognl@isNotEmpty(deviceType)">
                and a.device_id = #{deviceType}
            </if>
            <if test="@Ognl@isNotEmpty(studyids)">
             	and a.studyinfo_id in 
                <foreach item="item" index="index" collection="studyids" open="(" separator="," close=")">  
				  #{item}  
				 </foreach>  
            </if>
        </where>
        <if test="@Ognl@isNotEmpty(page)">
            limit #{page.firstIndex}, #{page.pageSize}
        </if>
    </select>
    
    <select id="getStudyInfoIdList" resultType="String" parameterType="java.util.Map">
        select a.study_cp_id as studyid
         from study_info a 
        <where>
        	1=1
            <if test="@Ognl@isNotEmpty(checkItem)">
                and a.check_item = #{checkItem}
            </if>
            <if test="@Ognl@isNotEmpty(position)">
                and (a.position = #{position}  or  a.sub_position =  #{position}   )
            </if>
        </where>
    </select>
    
    
    <select id="getCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(*) from study_info a ,patient b ,hospital c
        <where>
        	1=1
        	and a.pat_id = b.pat_id
        	
        	and a.hosp_id = c.hosp_id
            <if test="@Ognl@isNotEmpty(hospitalId)">
                and a.hosp_id = #{hospitalId}
            </if>
            <if test="@Ognl@isNotEmpty(patientName)">
                and b.pat_name like '%${patientName}%'
            </if>
            <if test="@Ognl@isNotEmpty(patientId)">
                and b.pat_id = #{patientId}
            </if>
            <if test="@Ognl@isNotEmpty(patientSex)">
                and b.sex = #{patientSex}
            </if>
            <if test="@Ognl@isNotEmpty(deviceType)">
                and a.device_id = #{deviceType}
            </if>
            
             <if test="@Ognl@isNotEmpty(studyids)">
             	and a.studyinfo_id in 
                <foreach item="item" index="index" collection="studyids" open="(" separator="," close=")">  
				  #{item}  
				 </foreach>  
            </if>
        </where>
    </select>

</mapper>